<!DOCTYPE html>
<html>

  <head>
    <title>Map2.G2</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://www.bing.com/sa/simg/bing_p_rr_teal_min.ico" rel="shortcut icon">
       <style type='text/css'>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        font-family: 'Segoe UI', Helvetica, Arial, Sans-Serif
      }

    </style>


  </head>

  <body>
    
    <div id='myMap' style='width: 100vw; height: 100vh;'></div>


    <script type='text/javascript'>
      var map;
      var infobo = []; //** Add **

      function GetMap() {
        var map = new Microsoft.Maps.Map(document.getElementById('myMap'), {
          credentials: 'Aoqwq4MnPOtVqxAFpjmjLSCMwmgpxjcgNVJa9y50KRNOxCNVXXg30Eopyg9i5jrc',
          center: new Microsoft.Maps.Location(4.318729, 148.452588),
          zoom: 3
        });
        
////////////////////////////TITLE////////////////////////////////////////////
        
        //Title
        var title = new Microsoft.Maps.Layer();
        //Add zoom information as metadata of the layer. 
        title.metadata = {
          zoomRange: {
            min: 3,
            max: 3
          }
        };
        var pushpin = new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(29.778736, 128.295643), {
          icon: 'https://www.gitcdn.xyz/repo/Nick-Shannon/cd3ec25ee6418959bb0b6788bae3af05/raw/65f909930f8f00ecd40db923f7350c8e4668710f/travel2.svg',
          anchor: new Microsoft.Maps.Point(0, 0)
        });
        //Add pushpins 
        title.add((pushpin));
        //Add layer to map. 
        map.layers.insert(title);

    
 /////////////////////////////////////////////////HOLIDAY POINTS////////////////////////////////////////       
        
        
        //Holiday points 1
        var holiday1 = new Microsoft.Maps.Layer();
        //Add zoom information as metadata of the layer.
        holiday1.metadata = {
            zoomRange: {
                min: 4,
                max: 12
            }
        };

        //pin1
        var pin1 = new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(43.649720, -79.481480), null);
        infobo[0] = new Microsoft.Maps.Infobox(new Microsoft.Maps.Location(43.649720, -79.481480), {
            maxHeight: 300,
            maxWidth: 420,
            title: 'Colombia',
            description: 'Cocora valley <br> <br>' + '<img src="https://pbs.twimg.com/media/Dwt9_cwXgAAnC8V.jpg" height="210" alt="Mountain View">',
            visible: false,
            autoAlignment: true
        });
        //************************************************
        //infobo[0]
        //************************************************
        infobo[0].setMap(map);
        Microsoft.Maps.Events.addHandler(pin1, 'click', function() {
            _infoboClose(infobo,0); //** _infoboClose(array, arrayIndex); **
        });
        holiday1.add(pin1);
        //Add layer to map.
        map.layers.insert(holiday1);

        ////////////////////////////////////////////////
        //Holiday points 2
        var holiday2 = new Microsoft.Maps.Layer();
        //Add zoom information as metadata of the layer.
        holiday2.metadata = {
            zoomRange: {
                min: 4,
                max: 12
            }
        };


        //pin2
        var pin2 = new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(43.659585, -79.337501), null);
        infobo[1] = new Microsoft.Maps.Infobox(new Microsoft.Maps.Location(43.659585, -79.337501), {
            maxHeight: 300,
            maxWidth: 420,
            title: 'Montana',
            description: 'Big Sky <br> <br>' + '<img src="https://pbs.twimg.com/media/DxsemS_X0AADxyX.jpg"  height="200" alt="Mountain View">',
            visible: false,
            autoAlignment: true
        });
        //************************************************
        //infobo[1]
        //************************************************
        infobo[1].setMap(map);
        Microsoft.Maps.Events.addHandler(pin2, 'click', function() {
            _infoboClose(infobo,1); //** _infoboClose(array, arrayIndex); **
        });
        holiday2.add(pin2);
        //Add layer to map.
        map.layers.insert(holiday2);
        //////////////////////////////////////////////////

        //************************************************
        // infobo [ Show / Hide ]
        // _infoboClose(array, arrayIndex);
        //************************************************
        function _infoboClose(target,index){
            for(var i=0;i<target.length;i++){
                target[i].setOptions({
                    visible: false
                });
            }
            target[index].setOptions({
                visible: true
            });
        }
        
        
          
           
 ////////////////zoom points////////////////////////////////////////////////////////////////////////////////////    
        
        
        
        //Pushin Zooms 1
        var zoom1 = new Microsoft.Maps.Layer();
        //Add zoom information as metadata of the layer. 
        zoom1.metadata = {
          zoomRange: {
            min: 3,
            max: 7
          }
        };
        var pushpin = new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(43.506484, 142.576775), {
          icon: 'https://www.gitcdn.xyz/repo/Nick-Shannon/4235c3f97352e8c5c4b03f56ad3d60bf/raw/33636033778fc1434a18c36cb9f6ce87507a17ac/point.svg',
          anchor: new Microsoft.Maps.Point(12, 28)
        });
        zoom1.add(pushpin);
        Microsoft.Maps.Events.addHandler(pushpin, 'click', function(args) {
          map.setView({
            center: args.target.getLocation(),
            zoom: 8
          });
        });
        //Add layer to map. 
        map.layers.insert(zoom1);


        //////////////////////////
        //Pushin Zooms 2 Layer3
        var zoom2 = new Microsoft.Maps.Layer();
        //Add zoom information as metadata of the layer. 
        zoom2.metadata = {
          zoomRange: {
            min: 3,
            max: 7
          }
        };
        var pushpin = new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(36.457226, 138.906677), {
          icon: 'https://www.gitcdn.xyz/repo/Nick-Shannon/4235c3f97352e8c5c4b03f56ad3d60bf/raw/33636033778fc1434a18c36cb9f6ce87507a17ac/point.svg',
          anchor: new Microsoft.Maps.Point(12, 28)
        });
        zoom2.add(pushpin);
        Microsoft.Maps.Events.addHandler(pushpin, 'click', function(args) {
          map.setView({
            center: args.target.getLocation(),
            zoom: 8
          });
        });
        //Add layer to map. 
        map.layers.insert(zoom2);


       
///////////////////GeoJson////////////////////////////////////////////////////////////////////////////////////////////////

        var layerP = new Microsoft.Maps.Layer();
        //Add zoom information as metadata of the layer. 
        layerP.metadata = {
          zoomRange: {
            min: 4,
            max: 20
          }
        };


        var infobox = new Microsoft.Maps.Infobox();
        infobox.setOptions({
          visible: false,
          maxHeight: 400,
          maxWidth: 400,
          autoAlignment: true
        });
        infobox.setMap(map);

        Microsoft.Maps.loadModule('Microsoft.Maps.GeoJson', function() {
          Microsoft.Maps.GeoJson.readFromUrl('https://opendata.arcgis.com/datasets/80db27fdc30344feb38f336193482719_0.geojson', function(shapes) {
            layerP.add((shapes));
            Microsoft.Maps.Events.addHandler(layerP, 'click', function(args) {
              var img = new Image();
              // load the image first in order to show the infobox 'correctly' 
              img.onload = function() {
                var html = '<div>' + args.target.metadata.direction + '<br/><br/>' + args.target.metadata.description + '<br/><br/>' + '</div>';
                html += '<img src=" ' + this.src + '" width="300" />';
                infobox.setOptions({
                  location: args.target.getLocation(),
                  title: args.target.metadata.name,
                  description: html,
                  visible: true
                });
              }

              img.src = args.target.metadata.imageUrl;
            });
          });
        });



        map.layers.insert(layerP);

        
        

////////////////Countries///////////////////////////////////////////////////////////////////////////////////////

       
        var layer1 = new Microsoft.Maps.Layer();
        //Add zoom information as metadata of the layer. 
        layer1.metadata = {
          zoomRange: {
            min: 1,
            max: 3
          }
        };
        //Load the Spatial Data Services module.
        Microsoft.Maps.loadModule('Microsoft.Maps.SpatialDataService', function() {
          //Create an array of state boundaries to retrieve.
          var countries1 = ['Russia', 'France', 'Italy'];
          var geoDataRequestOptions = {
            entityType: 'CountryRegion',
            getAllPolygons: false,
          };
          //Use the GeoData API manager to get the State
          Microsoft.Maps.SpatialDataService.GeoDataAPIManager.getBoundary(countries1, geoDataRequestOptions, map, function(data) {
            if (data.results && data.results.length > 0) {
              layer1.add((data.results[0].Polygons));
            }
          });
          //Create an array of locations to get the boundaries of 
          var countries2 = ['Japan', 'Austria', 'Switzerland', 'New Zealand', 'Singapore', 'Colombia', 'Peru', 'Netherland', 'South Korea', 'Tonga', 'Ireland', 'Mongolia'];
          var geoDataRequestOptions = {
            entityType: 'CountryRegion',
            getAllPolygons: true,
          };
          //Use the GeoData API manager to get the boundary 
          Microsoft.Maps.SpatialDataService.GeoDataAPIManager.getBoundary(countries2, geoDataRequestOptions, map, function(data) {
            if (data.results && data.results.length > 0) {
              layer1.add((data.results[0].Polygons));
            }
          });
          //Create an array of locations to get the boundaries of 
          var states1 = ['Victoria, Australia', 'Western Australia', 'Northern Territory', 'Queensland', 'New South Wales', 'Doha', 'Dubai', 'California', 'nevada', 'utah', 'arizona', 'colorado', 'dc', 'maryland', 'new york', 'British Columbia', 'Beijing', 'Montana', 'England', 'Scotland', 'Northern Ireland'];
          var geoDataRequestOptions = {
            entityType: 'AdminDivision1',
            getAllPolygons: true,
          };
          //Use the GeoData API manager to get the State
          Microsoft.Maps.SpatialDataService.GeoDataAPIManager.getBoundary(states1, geoDataRequestOptions, map, function(data) {
            if (data.results && data.results.length > 0) {
              layer1.add((data.results[0].Polygons));
            }
          });
        });
                        
        //Add layer to map. 
        map.layers.insert(layer1);
        
        
  //////////////////////////////////Zoom range code////////////////////////////////////////////      
        
        
        //Add a viewchangeend event to the map so that it updates the visibility of the layers. 
        Microsoft.Maps.Events.addHandler(map, 'viewchangeend', updateLayerVisibility);
        //Do an initial update of the visibility. 
        updateLayerVisibility();

        function updateLayerVisibility() {
          //Get the current zoom level of the map. 
          var zoom = map.getZoom();
          var layer;
          //Loop through the layers in the map and check to see if it has zoomRange metadata. 
          for (var i = 0; i < map.layers.length; i++) {
            layer = map.layers[i];
            if (layer.metadata && layer.metadata.zoomRange) {
              if (zoom >= layer.metadata.zoomRange.min && zoom <= layer.metadata.zoomRange.max) {
                layer.setVisible(true);
              } else {
                layer.setVisible(false);
              }
            }
          }
        }
      }

    </script>
    <script type='text/javascript' src='https://www.bing.com/api/maps/mapcontrol?callback=GetMap&key=AgmExgPK-Ij7H84tUYfRTcxyqIJFfeBncXCU9VKbXTtLZOinxBX-7eVvNqFU8JZC' async defer></script>



  </body>

</html>
